{
    "$schema": "https://vega.github.io/schema/vega-lite/v5.json",

    "params": [
        {
            "name": "SelectedYear",
            "value": 2023,
            "bind": {
                "input": "select",
                "options": [
                    2015, 2016, 2017, 2018, 2019, 2020, 2021, 2022, 2023
                ],
                "name": "Selecione o Ano: "
            }
        }
    ],
    "columns": 2,
    "concat": [
        {
            "title": "Quantidade de Gols",
            "data": { "url": "./data/campeonato-brasileiro-gols.csv" },
            "transform": [
                { "filter": "datum.ano == SelectedYear" }
                
            ],
            "mark": "bar",
            "encoding": {
                "y": {
                    "field": "clube",
                    "title": "Time",
                    "type": "nominal",
                    "sort": "-x"
                },
                "x": {
                    "aggregate": "count",
                    "field": "clube",
                    "title": "Gols"
                },
                
                "tooltip": [
                    { "field": "clube", "title": "Time" },
                    { "aggregate": "count", "field": "clube", "title": "Gols" }
                ]
            }
        },
        {
            "title": "Distribuição de Gols por Rodada",
            "data": { "url": "./data/campeonato-brasileiro-gols.csv" },
            "transform": [
                { "filter": "datum.ano == SelectedYear" },
                {
                    "aggregate": [
                        { "op": "count", "field": "atleta", "as": "gols" }
                    ],
                    "groupby": ["rodada"]
                }
            ],
            "mark": "line",
            "encoding": {
                "x": {
                    "field": "rodada",
                    "title": "Rodada",
                    "type": "ordinal",
                    "sort": [
                        "1", "2", "3", "4", "5", "6", "7", "8", "9", "10", "11", "12", "13", "14", "15", "16", "17", "18", "19", "20", "21", "22", "23", "24", "25", "26", "27", "28", "29", "30", "31", "32", "33", "34", "35", "36", "37", "38"
                    ]
                },
                "y": {
                    "field": "gols",
                    "title": "Gols",
                    "type": "quantitative"
                },
                "tooltip": [
                    { "field": "rodada", "title": "Rodada" },
                    { "field": "gols", "title": "Gols" }
                ]
            }
        },
        
        {
            "title": "Top 10 Artilheiros",
            "data": { "url": "./data/campeonato-brasileiro-gols.csv" },
            "transform": [
                { "filter": "datum.ano == SelectedYear" },
                { "filter": "datum.tipo_de_gol != 'Gol Contra'" },
                {
                    "aggregate": [
                        { "op": "count", "field": "atleta", "as": "gols" }
                    ],
                    "groupby": ["atleta", "clube"]
                },
                {
                    "sort": [{ "field": "gols", "order": "descending" }],
                    "window": [
                        {
                            "op": "rank",
                            "field": "gols",
                            "as": "rank"
                        }
                    ]
                },
                { "filter": "datum.rank <= 10" }
            ],
            "mark": "bar",
            "encoding": {
                "y": {
                    "sort": "-x",
                    "field": "atleta",
                    "title": "Atleta",
                    "type": "ordinal"
                },
                "x": {
                    "field": "gols",
                    "title": "Gols",
                    "type": "quantitative"
                },
                "tooltip": [
                    { "field": "atleta", "title": "Atleta" },
                    { "field": "gols", "title": "Gols" }
                ]
            }
        },
        
        {
            "title": "Contagem de Cartões",
            "data": { "url": "./data/campeonato-brasileiro-cartoes.csv" },
            "transform": [
                { "filter": "datum.ano == SelectedYear" },
                {
                    "aggregate": [
                        { "op": "count", "field": "cartao", "as": "quantidade" }
                    ],
                    "groupby": ["clube", "cartao"]
                }
            ],
            "mark": "bar",
            "encoding": {
                "x": {
                    "field": "clube",
                    "title": "Time",
                    "type": "nominal",
                    "sort": "-y"
                },
                "y": {
                    "field": "quantidade",
                    "title": "Quantidade de Cartões",
                    "type": "quantitative"
                },
                "xOffset": { "field": "cartao" },
                "color": {
                    "field": "cartao",
                    "title": "Tipo de Cartão",
                    "scale": {
                        "domain": ["Amarelo", "Vermelho"],
                        "range": ["yellow", "red"]
                    }
                },
                "tooltip": [
                    { "field": "clube", "title": "Time" },
                    { "field": "cartao", "title": "Tipo de Cartão" },
                    { "field": "quantidade", "title": "Quantidade" }
                ]
            }
        }
    ]
}
